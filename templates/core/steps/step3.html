{% extends "base.html" %}
{% block content %}

<!doctype html><html lang="ko"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>FO.AI – 3단계 결과</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
<style>.grad{background:linear-gradient(90deg,#22d3ee,#6ea8ff,#7c5cff)}</style>
</head><body class="bg-slate-50 text-slate-900 font-[Inter,'Noto Sans KR']">
<header class="bg-white border-b border-slate-200">
  <div class="max-w-4xl mx-auto px-4 h-14 flex items-center justify-between">
    <div class="font-extrabold">Fair Opportunity.AI</div>
    <div class="text-sm text-slate-500">Step 3 / 3</div>
  </div>
</header>

<main class="max-w-4xl mx-auto px-4 py-8">
  <h1 class="text-2xl font-extrabold">③ 결과 & 추천</h1>

  <!-- KPI -->
  <div class="mt-4 grid md:grid-cols-4 gap-4">
    <div class="bg-white border border-slate-200 rounded-2xl p-4">
      <div class="text-xs text-slate-500 font-bold">FOI</div>
      <div class="text-3xl font-extrabold mt-1">{{ foi }}</div>
      <div class="mt-3 h-2 bg-slate-100 rounded-full overflow-hidden">
        <div class="h-full grad" style="width: {{ foi }}%"></div>
      </div>
    </div>
    <div class="bg-white border border-slate-200 rounded-2xl p-4">
      <div class="text-xs text-slate-500 font-bold">EOI (개인화)</div>
      <div class="text-3xl font-extrabold mt-1">{{ eoiP }}</div>
      <div class="mt-3 h-2 bg-slate-100 rounded-full overflow-hidden">
        <div class="h-full grad" style="width: {{ eoiP }}%"></div>
      </div>
    </div>
    <div class="bg-white border border-slate-200 rounded-2xl p-4">
      <div class="text-xs text-slate-500 font-bold">LOI</div>
      <div class="text-3xl font-extrabold mt-1">{{ loi_score }}</div>
      <div class="mt-3 h-2 bg-slate-100 rounded-full overflow-hidden">
        <div class="h-full grad" style="width: {{ loi_score }}%"></div>
      </div>
    </div>
    <div class="bg-white border border-slate-200 rounded-2xl p-4">
      <div class="text-xs text-slate-500 font-bold">FGS</div>
      <div class="text-3xl font-extrabold mt-1">{{ fgs }}</div>
      <div class="mt-3 h-2 bg-slate-100 rounded-full overflow-hidden">
        <div class="h-full grad" style="width: {{ fgs }}%"></div>
      </div>
    </div>
  </div>

  <!-- Insight -->
  <section class="mt-6 bg-white border border-slate-200 rounded-2xl p-5">
    <h3 class="text-lg font-extrabold">AI 해석</h3>
    <p class="mt-2 text-sm text-slate-600">
      {{ basic.region }} · {{ basic.edu }} 기준으로 산출된 FOI/EOI/LOI를 종합해 FGS를 계산했습니다.
      점수가 낮은 축을 보완하는 과정(온라인 무료/비전공 우대 등)을 우선 추천합니다.
    </p>
  </section>

  <!-- Recs (샘플 카드) -->
  <section class="mt-6 bg-white border border-slate-200 rounded-2xl p-5">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-extrabold">추천 기회</h3>
      <div class="text-xs text-slate-500">필터: {{ basic.online_only|yesno:"온라인,오프라인" }} / {{ basic.free_only|yesno:"무료,유료" }}</div>
    </div>
    <div class="mt-4 space-y-3">
      <div class="flex items-center justify-between gap-3 border border-slate-200 rounded-xl p-4 bg-slate-50">
        <div>
          <div class="font-extrabold">디지털 UX 입문 <span class="ml-2 text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700">온라인</span><span class="ml-1 text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-700">무료</span></div>
          <div class="text-xs text-slate-500 mt-1">#비전공우대 #원격 #정부지원</div>
        </div>
        <div class="flex items-center gap-3">
          <div class="text-cyan-600 font-extrabold">+7p</div>
          <a class="px-3 py-1.5 rounded-lg border border-slate-200 hover:bg-white" href="#">상세보기 →</a>
        </div>
      </div>
      <!-- 필요 시 반복 -->
    </div>
  </section>

  <div class="mt-6 flex justify-between">
      <a href="{% url 'step2' %}" class="px-5 py-2 rounded-xl border">← 이전</a>
      <div class="space-x-2"
      <a id="btn-save" href="{% url 'save_assessment' %}" class="px-5 py-2 rounded-xl border">결과 저장</a>
      <a href="{% url 'step1' %}" class="px-5 py-2 rounded-xl bg-blue-600 text-white font-bold">처음으로</a>
  <!-- step3.html -->
      <a href="{% url 'goal_create' %}" class="ml-2 px-4 py-2 bg-green-600 text-white rounded-lg">목표 설정</a>
  </div>
    </div>
</main>
<!-- 세션 데이터 안전 주입 -->
{{ basic|json_script:"fo-basic" }}
{{ loi|json_script:"fo-loi" }}

<label class="inline-flex items-center gap-2 text-sm text-slate-600 mt-4">
  <input type="checkbox" id="privacyMode"> 프라이버시 모드(서버 미전송)
</label>

<script>
  // 안전하게 주입된 JSON 읽기
  const basic = JSON.parse(document.getElementById("fo-basic").textContent || "{}");
  const loi   = JSON.parse(document.getElementById("fo-loi").textContent || "{}");

  // 프라이버시 모드 on/off 저장
  const pm = document.querySelector("#privacyMode");
  pm.checked = localStorage.getItem("fo_privacy") === "1";
  pm.addEventListener("change", () => {
    localStorage.setItem("fo_privacy", pm.checked ? "1" : "0");
  });

  // "결과 저장" 버튼을 a태그로 만들었다면 id를 달아 핸들링하자.
  // 예: <a id="btn-save" href="{% url 'save_assessment' %}" ...>결과 저장</a>
  const btnSave = document.getElementById("btn-save");
  if (btnSave) {
    btnSave.addEventListener("click", (e) => {
      if (localStorage.getItem("fo_privacy") === "1") {
        // 서버 전송 막고 로컬에만 저장
        e.preventDefault();
        const payload = { basic, loi, saved_at: new Date().toISOString() };
        localStorage.setItem("fo_last_snapshot", JSON.stringify(payload));
        alert("프라이버시 모드: 결과를 브라우저에만 저장했습니다.");
      }
    });
  }

  // 만약 저장 버튼이 여러 개이거나 a[href$="save-assessment/"] 셀렉터를 쓰고 싶다면 아래처럼:
  // document.querySelectorAll('a[href$="save-assessment/"]').forEach(a => {
  //   a.addEventListener("click", handlerSameAsAbove);
  // });
</script>

</body></html>
{% endblock %}